<!-- Import Polymer -->
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="voice-recognition" attributes="continuous text">
    <script>
        Polymer('voice-recognition', {
            /* -- Attributes ------------------------------------------------ */
            continuous: true,
            text: '',

            /* -- Lifecycle ------------------------------------------------- */
            created: function() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new window.webkitSpeechRecognition();
                }
                else {
                    console.error('Your browser do not support the Web Speech API');
                }
            },

            ready: function() {
                this.recognition.continuous = this.continuous;
                this.recognition.interimResults = false;

                this.onStart();
                this.onError();
                this.onEnd();
                this.onResult();
            },
            start: function() {
                this.recognition.start();
            },
            onStart: function() {
                var that = this;

                this.recognition.addEventListener('start', function(e) {
                    that.fire('start', e);
                });
            },
            onError: function() {
                var that = this;

                this.recognition.addEventListener('error', function(e) {
                    that.fire('error', e);
                });
            },
            onEnd: function() {
                var that = this;

                this.recognition.addEventListener('end', function(e) {
                    that.fire('end', e);
                });
            },
            onResult: function() {
                var that = this;

                this.recognition.addEventListener('result', function(e) {
                    for (var i = e.resultIndex; i < e.results.length; ++i) {
                        that.text += e.results[i][0].transcript;
                        e.result = that.text;
                    }

                    that.fire('result', e);
                });
            }
        });
    </script>

</polymer-element>

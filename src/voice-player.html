<!-- Import Polymer -->
<link rel="import" href="../bower_components/polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="voice-player" attributes="autoplay text pitch rate volume">
    <script>
        Polymer('voice-player', {
            /* -- Attributes ------------------------------------------------ */
            autoplay: false,
            text: 'You are awesome',
            pitch: 1,
            rate: 1,
            volume: 1,

            /* -- Lifecycle ------------------------------------------------- */
            created: function() {
                if ('speechSynthesis' in window) {
                    this.speech = new SpeechSynthesisUtterance();
                }
                else {
                    console.error('Your browser do not support the Web Speech API');
                }
            },

            ready: function() {
                // Initialize attributes
                this.textChanged();
                this.pitchChanged();
                this.rateChanged();
                this.volumeChanged();

                // Initialize event listeners
                this.onStart();
                this.onEnd();
                this.onError();
                this.onPause();
                this.onResume();

                if (this.autoplay) {
                    this.speak();
                }
            },

            textChanged  : function() { this.speech.text = this.text;     },
            pitchChanged : function() { this.speech.pitch = this.pitch;   },
            rateChanged  : function() { this.speech.rate = this.rate;     },
            volumeChanged: function() { this.speech.volume = this.volume; },

            /* -- Methods --------------------------------------------------- */
            speak: function() {
                window.speechSynthesis.speak(this.speech);
            },
            cancel: function() {
                window.speechSynthesis.cancel();
            },
            pause: function() {
                window.speechSynthesis.pause();
            },
            resume: function() {
                window.speechSynthesis.resume();
            },

            /* -- Events ---------------------------------------------------- */
            onStart: function() {
                var that = this;

                this.speech.addEventListener('start', function(e) {
                    that.fire('start', e);
                });
            },
            onEnd: function() {
                var that = this;

                this.speech.addEventListener('end', function(e) {
                    that.fire('end', e);
                });
            },
            onError: function() {
                var that = this;

                this.speech.addEventListener('error', function(e) {
                    that.fire('error', e);
                });
            },
            onPause: function() {
                var that = this;

                this.speech.addEventListener('pause', function(e) {
                    that.fire('pause', e);
                });
            },
            onResume: function() {
                var that = this;

                this.speech.addEventListener('resume', function(e) {
                    that.fire('resume', e);
                });
            }
        });
    </script>

</polymer-element>
